{"ast":null,"code":"import _regeneratorRuntime from\"/Users/benjaminbenitez/Desktop/React/FashionProject/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/benjaminbenitez/Desktop/React/FashionProject/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/benjaminbenitez/Desktop/React/FashionProject/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState}from'react';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';import{useSelector}from'react-redux';import{selectCartTotal}from'../../store/cart/cart.selector';import{selectCurrentUser}from'../../store/user/user.selector';import{BUTTON_TYPE_CLASSES}from'../button/button.component';import{PaymentFormContainer,FormContainer,PaymentButton}from'./payment-form.styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ifValidCardElement=function ifValidCardElement(card){return card!==null;};var PaymentForm=function PaymentForm(){var stripe=useStripe();var elements=useElements();var amount=useSelector(selectCartTotal);var currentUser=useSelector(selectCurrentUser);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isProcessingPayment=_useState2[0],setIsProcessingPayment=_useState2[1];var paymentHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var response,client_secret,cardDetails,paymentResult;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:setIsProcessingPayment(true);_context.next=6;return fetch('/.netlify/functions/create-payment-intent',{method:'post',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:amount*100})}).then(function(res){return res.json();});case 6:response=_context.sent;client_secret=response.paymentIntent.client_secret;cardDetails=elements.getElement(CardElement);if(ifValidCardElement(cardDetails)){_context.next=11;break;}return _context.abrupt(\"return\");case 11:_context.next=13;return stripe.confirmCardPayment(client_secret,{payment_method:{card:cardDetails,billing_details:{name:currentUser?currentUser.displayName:'Guest'}}});case 13:paymentResult=_context.sent;setIsProcessingPayment(false);if(paymentResult.error){alert(paymentResult.error);}else{if(paymentResult.paymentIntent.status==='succeeded'){alert('Payment Successful');}}case 16:case\"end\":return _context.stop();}},_callee);}));return function paymentHandler(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(PaymentFormContainer,{children:/*#__PURE__*/_jsxs(FormContainer,{onSubmit:paymentHandler,children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Credit Card Payment: \"}),/*#__PURE__*/_jsx(CardElement,{}),/*#__PURE__*/_jsx(PaymentButton,{isLoading:isProcessingPayment,buttonType:BUTTON_TYPE_CLASSES.Inverted// Update the value here\n,children:\"Pay now\"})]})});};export default PaymentForm;","map":{"version":3,"names":["useState","CardElement","useStripe","useElements","useSelector","selectCartTotal","selectCurrentUser","BUTTON_TYPE_CLASSES","PaymentFormContainer","FormContainer","PaymentButton","jsx","_jsx","jsxs","_jsxs","ifValidCardElement","card","PaymentForm","stripe","elements","amount","currentUser","_useState","_useState2","_slicedToArray","isProcessingPayment","setIsProcessingPayment","paymentHandler","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","e","response","client_secret","cardDetails","paymentResult","wrap","_callee$","_context","prev","next","preventDefault","abrupt","fetch","method","headers","body","JSON","stringify","then","res","json","sent","paymentIntent","getElement","confirmCardPayment","payment_method","billing_details","name","displayName","error","alert","status","stop","_x","apply","arguments","children","onSubmit","isLoading","buttonType","Inverted"],"sources":["/Users/benjaminbenitez/Desktop/React/FashionProject/src/components/payment-form/payment-form.component.tsx"],"sourcesContent":["import { useState, FormEvent } from 'react';\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { StripeCardElement } from '@stripe/stripe-js';\nimport { useSelector } from 'react-redux';\n\nimport { selectCartTotal } from '../../store/cart/cart.selector';\nimport { selectCurrentUser } from '../../store/user/user.selector';\n\nimport { BUTTON_TYPE_CLASSES } from '../button/button.component';\n\nimport {\n  PaymentFormContainer,\n  FormContainer,\n  PaymentButton,\n} from './payment-form.styles';\n\nconst ifValidCardElement = (\n  card: StripeCardElement | null\n): card is StripeCardElement => card !== null;\n\nconst PaymentForm = () => {\n  const stripe = useStripe();\n  const elements = useElements();\n  const amount = useSelector(selectCartTotal);\n  const currentUser = useSelector(selectCurrentUser);\n  const [isProcessingPayment, setIsProcessingPayment] = useState(false);\n\n  const paymentHandler = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    setIsProcessingPayment(true);\n\n    const response = await fetch('/.netlify/functions/create-payment-intent', {\n      method: 'post',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ amount: amount * 100 }),\n    }).then((res) => res.json());\n\n    const {\n      paymentIntent: { client_secret },\n    } = response;\n\n    const cardDetails = elements.getElement(CardElement);\n\n    if (!ifValidCardElement(cardDetails)) return;\n\n    const paymentResult = await stripe.confirmCardPayment(client_secret, {\n      payment_method: {\n        card: cardDetails,\n        billing_details: {\n          name: currentUser ? currentUser.displayName : 'Guest',\n        },\n      },\n    });\n\n    setIsProcessingPayment(false);\n\n    if (paymentResult.error) {\n      alert(paymentResult.error);\n    } else {\n      if (paymentResult.paymentIntent.status === 'succeeded') {\n        alert('Payment Successful');\n      }\n    }\n  };\n\n  return (\n    <PaymentFormContainer>\n      <FormContainer onSubmit={paymentHandler}>\n        <h2>Credit Card Payment: </h2>\n        <CardElement />\n        <PaymentButton\n          isLoading={isProcessingPayment}\n          buttonType={BUTTON_TYPE_CLASSES.Inverted} // Update the value here\n        >\n          Pay now\n        </PaymentButton>\n      </FormContainer>\n    </PaymentFormContainer>\n  );\n};\n\nexport default PaymentForm;"],"mappings":"2aAAA,OAASA,QAAQ,KAAmB,OAAO,CAC3C,OAASC,WAAW,CAAEC,SAAS,CAAEC,WAAW,KAAQ,yBAAyB,CAE7E,OAASC,WAAW,KAAQ,aAAa,CAEzC,OAASC,eAAe,KAAQ,gCAAgC,CAChE,OAASC,iBAAiB,KAAQ,gCAAgC,CAElE,OAASC,mBAAmB,KAAQ,4BAA4B,CAEhE,OACEC,oBAAoB,CACpBC,aAAa,CACbC,aAAa,KACR,uBAAuB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE/B,GAAM,CAAAC,kBAAkB,CAAG,QAArB,CAAAA,kBAAkBA,CACtBC,IAA8B,QACA,CAAAA,IAAI,GAAK,IAAI,GAE7C,GAAM,CAAAC,WAAW,CAAG,QAAd,CAAAA,WAAWA,CAAA,CAAS,CACxB,GAAM,CAAAC,MAAM,CAAGhB,SAAS,CAAC,CAAC,CAC1B,GAAM,CAAAiB,QAAQ,CAAGhB,WAAW,CAAC,CAAC,CAC9B,GAAM,CAAAiB,MAAM,CAAGhB,WAAW,CAACC,eAAe,CAAC,CAC3C,GAAM,CAAAgB,WAAW,CAAGjB,WAAW,CAACE,iBAAiB,CAAC,CAClD,IAAAgB,SAAA,CAAsDtB,QAAQ,CAAC,KAAK,CAAC,CAAAuB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAA9DG,mBAAmB,CAAAF,UAAA,IAAEG,sBAAsB,CAAAH,UAAA,IAElD,GAAM,CAAAI,cAAc,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAOC,CAA6B,MAAAC,QAAA,CAAAC,aAAA,CAAAC,WAAA,CAAAC,aAAA,QAAAP,mBAAA,GAAAQ,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SACzDT,CAAC,CAACU,cAAc,CAAC,CAAC,CAAC,KAEf,CAACzB,MAAM,EAAI,CAACC,QAAQ,GAAAqB,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAI,MAAA,kBAIxBlB,sBAAsB,CAAC,IAAI,CAAC,CAACc,QAAA,CAAAE,IAAA,SAEN,CAAAG,KAAK,CAAC,2CAA2C,CAAE,CACxEC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,cAAc,CAAE,kBAClB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CAAE9B,MAAM,CAAEA,MAAM,CAAG,GAAI,CAAC,CAC/C,CAAC,CAAC,CAAC+B,IAAI,CAAC,SAACC,GAAG,QAAK,CAAAA,GAAG,CAACC,IAAI,CAAC,CAAC,GAAC,QANtBnB,QAAQ,CAAAM,QAAA,CAAAc,IAAA,CASKnB,aAAa,CAC5BD,QAAQ,CADVqB,aAAa,CAAIpB,aAAa,CAG1BC,WAAW,CAAGjB,QAAQ,CAACqC,UAAU,CAACvD,WAAW,CAAC,IAE/Cc,kBAAkB,CAACqB,WAAW,CAAC,EAAAI,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAI,MAAA,mBAAAJ,QAAA,CAAAE,IAAA,UAER,CAAAxB,MAAM,CAACuC,kBAAkB,CAACtB,aAAa,CAAE,CACnEuB,cAAc,CAAE,CACd1C,IAAI,CAAEoB,WAAW,CACjBuB,eAAe,CAAE,CACfC,IAAI,CAAEvC,WAAW,CAAGA,WAAW,CAACwC,WAAW,CAAG,OAChD,CACF,CACF,CAAC,CAAC,SAPIxB,aAAa,CAAAG,QAAA,CAAAc,IAAA,CASnB5B,sBAAsB,CAAC,KAAK,CAAC,CAE7B,GAAIW,aAAa,CAACyB,KAAK,CAAE,CACvBC,KAAK,CAAC1B,aAAa,CAACyB,KAAK,CAAC,CAC5B,CAAC,IAAM,CACL,GAAIzB,aAAa,CAACkB,aAAa,CAACS,MAAM,GAAK,WAAW,CAAE,CACtDD,KAAK,CAAC,oBAAoB,CAAC,CAC7B,CACF,CAAC,yBAAAvB,QAAA,CAAAyB,IAAA,MAAAjC,OAAA,GACF,kBA3CK,CAAAL,cAAcA,CAAAuC,EAAA,SAAAtC,IAAA,CAAAuC,KAAA,MAAAC,SAAA,OA2CnB,CAED,mBACExD,IAAA,CAACJ,oBAAoB,EAAA6D,QAAA,cACnBvD,KAAA,CAACL,aAAa,EAAC6D,QAAQ,CAAE3C,cAAe,CAAA0C,QAAA,eACtCzD,IAAA,OAAAyD,QAAA,CAAI,uBAAqB,CAAI,CAAC,cAC9BzD,IAAA,CAACX,WAAW,GAAE,CAAC,cACfW,IAAA,CAACF,aAAa,EACZ6D,SAAS,CAAE9C,mBAAoB,CAC/B+C,UAAU,CAAEjE,mBAAmB,CAACkE,QAAU;AAAA,CAAAJ,QAAA,CAC3C,SAED,CAAe,CAAC,EACH,CAAC,CACI,CAAC,CAE3B,CAAC,CAED,cAAe,CAAApD,WAAW"},"metadata":{},"sourceType":"module","externalDependencies":[]}